<!DOCTYPE html>
<html>

<head>
  <title>Dynamic Image</title>
</head>

<body>
  <canvas id="myCanvas" width="1080" height="1920"></canvas>
  <button onclick="openImage()">Generate Image</button>

  <script>
    // Get the canvas element
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");

    // Set the background color
    ctx.fillStyle = "#212529";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Set the text variables
    var headline = "My Ï€-Horoscope"
    var number = "8";
    var position = " Digit 8990 988";
    var prompt = "Your financial situation may be stable or improving, so use this opportunity to make smart investments or save for the future.";

    // Set the text styles
    var headlineStyle = "bold 110px Arial";
    var numberStyle = "bold 120px Arial";
    var positionStyle = "normal 40px Arial";
    var promptStyle = "normal 70px Arial";

    // Define the gradient for the text color
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
    gradient.addColorStop(0, '#8a54c1');
    gradient.addColorStop(1, '#fc466b');

    // Draw the text on the canvas with the gradient color
    ctx.fillStyle = gradient;
    ctx.font = headlineStyle;
    ctx.textAlign = 'center';
    ctx.fillText(headline, canvas.width / 2, canvas.height / 2 - 600);

    ctx.fillStyle = gradient;
    ctx.font = numberStyle;
    ctx.fillText(number, canvas.width / 2, canvas.height / 2 - 300);

    ctx.fillStyle = gradient;
    ctx.font = positionStyle;
    ctx.fillText(position, canvas.width / 2, canvas.height / 2 - 230);

    ctx.fillStyle = gradient;
    ctx.font = promptStyle;
    let wrappedText = wrapText(ctx, prompt, canvas.width / 2, canvas.height / 2 + 150, 850, 70)
    wrappedText.forEach(function (item) {
      // item[0] is the text
      // item[1] is the x coordinate to fill the text at
      // item[2] is the y coordinate to fill the text at
      ctx.fillText(item[0], item[1], item[2]);
    })

    // Define button properties
    const width = 300;
    const height = 70;
    const x = canvas.width / 2 - 150;
    const y = canvas.height / 2 + 700;
    const borderRadius = 30;
    const borderWidth = 3;
    const borderColor = 'white';
    const fillColor = 'transparent';
    const link = "pi.schneuer.online";

    // Calculate x and y positions with borderRadius offset
    const xPos = x + borderRadius;
    const yPos = y + borderRadius;

    // Draw the button
    ctx.beginPath();
    ctx.moveTo(xPos, y);
    ctx.lineTo(xPos + width - borderRadius * 2, y);
    ctx.arcTo(x + width, y, x + width, y + borderRadius, borderRadius);
    ctx.lineTo(x + width, yPos + height - borderRadius * 2);
    ctx.arcTo(x + width, y + height, xPos + width - borderRadius * 2, y + height, borderRadius);
    ctx.lineTo(xPos, y + height);
    ctx.arcTo(x, y + height, x, yPos + height - borderRadius * 2, borderRadius);
    ctx.lineTo(x, yPos);
    ctx.arcTo(x, y, xPos, y, borderRadius);
    ctx.lineTo(xPos + width - borderRadius * 2, y);
    ctx.closePath();

    ctx.lineWidth = borderWidth;
    ctx.strokeStyle = borderColor;
    ctx.fillStyle = fillColor;
    ctx.fill();
    ctx.stroke();

    // Draw the text
    ctx.font = 'bold 30px Arial';
    ctx.fillStyle = "#ffffff";
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(link, x + width / 2, y + height / 2);

    // Function to open the image in a new tab
    function openImage() {
      // Calculate the aspect ratio of the canvas
      var aspectRatio = canvas.width / canvas.height;

      // Convert the canvas to an image
      var dataURL = canvas.toDataURL("image/png");

      // Create an image element with the data URL as its source
      var img = document.createElement("img");
      img.src = dataURL;

      // Resize the image while maintaining aspect ratio
      if (window.innerWidth / window.innerHeight > aspectRatio) {
        img.style.height = window.innerHeight + "px";
        img.style.width = "auto";
      } else {
        img.style.width = window.innerWidth + "px";
        img.style.height = "auto";
      }

      // Set the max-width and max-height to 100%
      img.style.maxWidth = "100%";
      img.style.maxHeight = "100%";

      // Open the image in a new tab
      var newTab = window.open();
      newTab.document.body.style.margin = "0";
      newTab.document.body.style.padding = "0";
      newTab.document.body.appendChild(img);
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {    // First, start by splitting all of our text into words, but splitting it into an array split by spaces
      let words = text.split(' ');
      let line = ''; // This will store the text of the current line
      let testLine = ''; // This will store the text when we add a word, to test if it's too long
      let lineArray = []; // This is an array of lines, which the function will return

      // Lets iterate over each word
      for (var n = 0; n < words.length; n++) {
        // Create a test line, and measure it..
        testLine += `${words[n]} `;
        let metrics = ctx.measureText(testLine);
        let testWidth = metrics.width;
        // If the width of this test line is more than the max width
        if (testWidth > maxWidth && n > 0) {
          // Then the line is finished, push the current line into "lineArray"
          lineArray.push([line, x, y]);
          // Increase the line height, so a new line is started
          y += lineHeight;
          // Update line and test line to use this word as the first word on the next line
          line = `${words[n]} `;
          testLine = `${words[n]} `;
        }
        else {
          // If the test line is still less than the max width, then add the word to the current line
          line += `${words[n]} `;
        }
        // If we never reach the full max width, then there is only one line.. so push it into the lineArray so we return something
        if (n === words.length - 1) {
          lineArray.push([line, x, y]);
        }
      }
      // Return the line array
      return lineArray;
    }

  </script>
</body>

</html>